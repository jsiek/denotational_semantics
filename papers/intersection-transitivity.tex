\documentclass{article}
\usepackage{natbib}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathabx}
\usepackage{stmaryrd}
\usepackage{semantic}
%\usepackage{fullpage}
\usepackage{fontspec,unicode-math}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{constraint}[theorem]{Constraint}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}


\title{Transitivity of Subtyping for Intersection Types}
\author{Jeremy G. Siek}

\begin{document}
\maketitle

\newcommand{\TOP}{\ensuremath{\mathtt{U}}}
\newcommand{\dom}[1]{\mathrm{dom}(#1)}
\newcommand{\cod}[1]{\mathrm{cod}(#1)}

\citet{Barendregt:1983aa}
\citet{Barendregt:2013aa}

\citet{Laurent:2012aa}
\citet{Laurent:2018aa}

$λ^{\mathrm{BCD}}_∩$

Figure~\ref{fig:types}

\begin{figure}[tbp]
  \[
  \begin{array}{lclr}
    \alpha,\beta & ::= & \TOP \mid c_0 \mid c_1 \mid c_2 \mid \cdots & \text{atoms}\\
    A,B,C,D & ::= & \alpha \mid A → B \mid A ∩ B & \text{types}
  \end{array}
  \]
  \caption{Intersection Types}
  \label{fig:types}
\end{figure}



Figure~\ref{fig:BCD-subtyping}

\begin{figure}[tbp]
  \fbox{$A ≤ B$} \\[1ex]
  
  \centering
  \begin{tabular}{p{1in}l}
    (refl)  & $A ≤ A$ \\[3ex]
    (incl$_L$) & $A ∩ B ≤ A$ \\[3ex]
    (incl$_R$) & $A ∩ B ≤ B$ \\[3ex]
    (glb) & $\inference{C ≤ A & C ≤ B}{C ≤ A ∩ B}$ \\[3ex]
    (trans) & $\inference{A ≤ B & B ≤ C}{A ≤ C}$ \\[3ex]
    ($\TOP_{\mathrm{top}}$) & $A ≤ \TOP$ \\[3ex]
    ($\TOP{→}$) & $\TOP ≤ A → \TOP$ \\[3ex]
    (${→}{∩}$) & $(A → B) ∩ (A → C) ≤ A → (B ∩ C)$ \\[3ex]
    ($→$) & $\inference{A' ≤ A & B ≤ B'}{A → B ≤ A' → B'}$
  \end{tabular}
  \caption{BCD Subtyping}
  \label{fig:BCD-subtyping}
\end{figure}

Figure~\ref{fig:aux}

\begin{figure}[tbp]

  \fbox{$\dom{A}, \cod{A}$}
  \begin{align*}
  \dom{A → B} &= A \\
  \dom{A ∩ B} &= \dom{A} ∩ \dom {B} \\
  \\
  \cod{A → B} &= B \\
  \cod{A ∩ B} &= \cod{A} ∩ \cod {B}
  \end{align*}

  \fbox{$\mathsf{top}(A)$}
  \begin{gather*}
    \mathsf{top}(\TOP)
    \quad
    \inference{\mathsf{top}(B)}{\mathsf{top}(A → B)}
    \quad
    \inference{\mathsf{top}(A) & \mathsf{top}(B)}{\mathsf{top}(A ∩ B)}
  \end{gather*}

  \fbox{$A ∈ B$}
  \begin{gather*}
    \inference{}{\alpha ∈ \alpha}  \quad
    \inference{}{A → B ∈ A → B} \\[3ex]
    \inference{A ∈ B}{A ∈ B ∩ C} \quad
    \inference{A ∈ C}{A ∈ B ∩ C}
  \end{gather*}

  \fbox{$A ⊆ B$}
  \[
     A ⊆ B = ∀ C.\, C ∈ A \text{ implies } C ∈ B
  \]

  \fbox{$\mathsf{topInCod}(D)$}
  \[
  \mathsf{topInCod}(D) =
     \exists A B.\, A → B ∈ D \text{ and } \mathsf{top}(B)  
  \]

  \caption{Auxilliary definitions}
  \label{fig:aux}
\end{figure}


\begin{figure}[tbp]
  \fbox{$A <: B$} \\[1ex]
  
  \centering
  \begin{tabular}{p{1in}l}
    (refl$_α$) & $\inference{}{α <: α}$ \\[3ex]
    (lb$_L$) & $\inference{A <: C}{A ∩ B <: C}$ \\[3ex]
    (lb$_R$) & $\inference{B <: C}{A ∩ B <: C}$ \\[3ex]
    (glb) & $\inference{C ≤ A & C ≤ B}{C ≤ A ∩ B}$ \\[3ex]
    ($\TOP_{\mathrm{top}}$) & $\inference{}{A <: \TOP}$ \\[3ex]
    ($\TOP{→}'$) & $\inference{}{C <: A → B}\;\mathsf{top}(B)$ \\[3ex]
    ($→'$) &$\inference{A <: \dom{D} & \cod{D} <: B }{C <: A → B}\begin{array}{l} \neg\, \mathsf{top}(B) \\ \neg \, \mathsf{topInCod}(D) \\ D ⊆ C \end{array}$
  \end{tabular}
  \caption{New Subtyping Relation}
  \label{fig:new-subtyping}
\end{figure}

\begin{definition}[factors]
  We say $A → B$ \emph{factors} $C$
  if there exists some type $C'$ such that
  $C' ⊆ C$, $\neg\,\mathsf{topInCod}(C')$, $A <: \dom{C'}$, and $\cod{C'} <: B$.
\end{definition}

\begin{lemma}\label{lem:sub-fun-inv}
  If $\neg\,\mathsf{top}(B)$,
  $D <: C$, and
  $A → B ∈ C$, then
  $A → B$ factors $D$.
\end{lemma}


\begin{lemma}\label{lem:sub-inv-trans}
  If
  \begin{itemize}
  \item $\neg\, \mathsf{topInCod}(D)$,
  \item for any $A,B$, if $\neg\,\mathsf{top}(B)$ and $A → B ∈ D$,
    then $A → B$ factors $C$,
  \end{itemize}
  then $\dom{D} → \cod{D}$ factors $C$.
\end{lemma}

\begin{align*}
  \mathsf{size}(\alpha) &= 0 \\
  \mathsf{size}(A → B) &= 1 + \mathsf{size}(A) + \mathsf{size}(B) \\
  \mathsf{size}(A ∩ B) &= 1 + \mathsf{size}(A) + \mathsf{size}(B)
\end{align*}

\begin{align*}
  \mathsf{depth}(\alpha) &= 0 \\
  \mathsf{depth}(A → B) &= 1 + \max(\mathsf{depth}(A), \mathsf{depth}(B)) \\
  \mathsf{depth}(A ∩ B) &= \max(\mathsf{depth}(A), \mathsf{depth}(B))
\end{align*}

\begin{lemma}[Transitivity of $<:$]\label{lem:sub-trans}
    If $A <: B$ and $B <: C$, then $A <: C$.
\end{lemma}


\begin{theorem}[Equivalence of the subtyping relations]\ \\
  $A <: B$ if and only if $A ≤ B$.
\end{theorem}

\clearpage
\pagebreak

\bibliographystyle{abbrvnat}
\bibliography{all}

\end{document}
